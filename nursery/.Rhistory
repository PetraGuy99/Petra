facet_grid(Species ~ Treatment, scales = "free_y") +
theme_bw() +
labs(
title = "Height Change vs Fertiliser",
x = "Fertiliser Level",
y = "Height Change"
)
facet_grid(Species ~ Treatment, scales = "free_y") +
theme_bw() +
labs(
title = "Height Change vs Fertiliser",
x = "Fertiliser Level",
y = "Height Change"
)
#make fertilizer a factor for this plot
merged_df <- merged_df %>%
mutate(
Fertiliser = as.numeric(as.character(Fertiliser)),
HeightChange = as.numeric(HeightChange)
)
library(purrr)
lm_stats <- merged_df %>%
group_by(Species, Treatment) %>%
summarise(
lm_fit = list(lm(HeightChange ~ Fertiliser, data = cur_data())),
.groups = "drop"
) %>%
mutate(
r2 = map_dbl(lm_fit, ~ summary(.x)$r.squared),
pval = map_dbl(lm_fit, ~ summary(.x)$coefficients[2,4]),
eq_label = paste0("R^2 == ", round(r2,2), "~p == ", signif(pval,3)) # plotmath
) %>%
select(-lm_fit, -r2, -pval)
merged_df <- merged_df %>%
mutate(Fertiliser_num = as.numeric(as.character(Fertiliser)))
# Step 2: Compute label positions per Species × Treatment
label_positions <- merged_df %>%
group_by(Species, Treatment) %>%
summarise(
label_y = max(HeightChange, na.rm = TRUE) * 1.05,   # slightly above max
label_x = min(Fertiliser_num, na.rm = TRUE) + 0.5,  # slightly inside left edge
.groups = "drop"
) %>%
left_join(lm_stats, by = c("Species", "Treatment"))
# Step 3: Plot
ggplot(merged_df, aes(x = Fertiliser_num, y = HeightChange)) +
geom_point() +
geom_smooth(method = "lm", se = TRUE, formula = y ~ x, color = "blue") +
geom_text(
data = label_positions,
aes(x = label_x, y = label_y, label = eq_label),
inherit.aes = FALSE,
hjust = 0,
size = 3,
parse = TRUE
) +
facet_grid(Species ~ Treatment, scales = "free_y") +
theme_bw() +
labs(
title = "Height Change vs Fertiliser",
x = "Fertiliser Level",
y = "Height Change"
)
subset_heb <- subset(birch, Treatment %in% c("co", "heb"))
t_test_heb <- t.test(
HeightChange ~ Treatment,
data = subset_heb
)
View(t_test_heb)
t_test_results <- birch %>%
group_by(Treatment) %>%
summarise(
t_test = list(t.test(HeightChange ~ Rep, data = cur_data())),
.groups = "drop"
) %>%
mutate(
p_value = map_dbl(t_test, ~ .$p.value),
label = paste0("p = ", signif(p_value, 3))
) %>%
select(Treatment, label)
t_test_heb$p.value
subset_pax <- subset(birch, Treatment %in% c("co", "pax"))
t_test_pax <- t.test(
HeightChange ~ Treatment,
data = subset_pax
)
p_val_pax = t_test_pax$p.value
p_val_pax = round(t_test_pax$p.value,2)
#df to add to gg plot
p_labels <- data.frame(
Treatment = c("heb", "pax"),               # Treatments to annotate
HeightChange = c(max(birch_avg$HeightChange[birch_avg$Treatment == "heb"]) * 1.05,
max(birch_avg$HeightChange[birch_avg$Treatment == "pax"]) * 1.05),
label = c(paste0("p = ", signif(p_val_heb, 3)),
paste0("p = ", signif(p_val_pax, 3)))
)
subset_heb <- subset(birch, Treatment %in% c("co", "heb"))
t_test_heb <- t.test(
HeightChange ~ Treatment,
data = subset_heb
)
p_val_heb = round(t_test_heb$p.value,2)
#do a t test for birch against co
subset_pax <- subset(birch, Treatment %in% c("co", "pax"))
t_test_pax <- t.test(
HeightChange ~ Treatment,
data = subset_pax
)
p_val_pax = round(t_test_pax$p.value,2)
#df to add to gg plot
p_labels <- data.frame(
Treatment = c("heb", "pax"),               # Treatments to annotate
HeightChange = c(max(birch_avg$HeightChange[birch_avg$Treatment == "heb"]) * 1.05,
max(birch_avg$HeightChange[birch_avg$Treatment == "pax"]) * 1.05),
label = c(paste0("p = ", signif(p_val_heb, 3)),
paste0("p = ", signif(p_val_pax, 3)))
)
##end t test#########
# Plot
ggplot(birch_avg, aes(x = Treatment, y = HeightChange)) +
geom_boxplot(aes(fill = Treatment),color = "black", outlier.shape = NA) +
geom_point(aes(color = Fertiliser), size = 3, position = position_dodge(width = 0.75)) +
scale_fill_manual(values = treatment_cols) +
scale_color_brewer(palette = "Set1") +  # or scale_color_manual for custom Fertiliser colors
theme_bw() +
labs(
x = "Treatment",
y = "Height Change",
color = "Fertiliser",
title = "Birch Height Change by Treatment (Average per Fertiliser Level)"
)
# Plot
ggplot(birch_avg, aes(x = Treatment, y = HeightChange)) +
geom_boxplot(aes(fill = Treatment), color = "black", outlier.shape = NA) +
geom_point(aes(color = Fertiliser), size = 3, position = position_dodge(width = 0.75)) +
geom_text(
data = p_labels,
aes(x = Treatment, y = HeightChange, label = label),
inherit.aes = FALSE,
vjust = 0  # position just above the boxplot
) +
scale_fill_manual(values = treatment_cols) +
scale_color_brewer(palette = "Set1") +
theme_bw() +
labs(
x = "Treatment",
y = "Height Change",
color = "Fertiliser",
title = "Birch Height Change by Treatment (Average per Fertiliser Level)"
)
subset_sui <- subset(birch, Treatment %in% c("co", "sui"))
t_test_sui <- t.test(
HeightChange ~ Treatment,
data = subset_sui
)
p_val_sui_co <- t_test_sui_co$p.value
pine_avg_subset <- pine_avg %>%
filter(Treatment %in% c("sui", "co"))
# Compute t-test
t_test_sui_co <- t.test(
HeightChange ~ Treatment,
data = pine_avg_subset
)
# Extract p-value
p_val_sui_co <- t_test_sui_co$p.value
# Create label data frame
p_labels_pine <- data.frame(
Treatment = "sui",  # put the label above 'sui'
HeightChange = max(pine_avg_subset$HeightChange) * 1.05,
label = paste0("p = ", signif(p_val_sui_co, 3))
)
# Plot
ggplot(pine_avg_subset, aes(x = Treatment, y = HeightChange)) +
geom_boxplot(aes(fill = Treatment), color = "black", outlier.shape = NA) +
geom_point(aes(color = Fertiliser), size = 3, position = position_dodge(width = 0.75)) +
geom_text(
data = p_labels_pine,
aes(x = Treatment, y = HeightChange, label = label),
inherit.aes = FALSE,
vjust = 0
) +
scale_fill_manual(values = treatment_cols) +
scale_color_brewer(palette = "Set1") +
theme_bw() +
labs(
x = "Treatment",
y = "Height Change",
color = "Fertiliser",
title = "Pine Height Change by Treatment (sui vs co)"
)
pine_avg_subset <- pine_avg %>%
filter(Treatment %in% c("sui", "co", "cb"))
# Compute t-test
t_test_sui_co <- t.test(
HeightChange ~ Treatment,
data = pine_avg_subset %>%filter(Treatment %in% c("co","sui"))
)
# Extract p-value
p_val_sui_co <- t_test_sui_co$p.value
# Create label data frame
p_labels_pine <- data.frame(
Treatment = "sui",  # put the label above 'sui'
HeightChange = max(pine_avg_subset$HeightChange) * 1.05,
label = paste0("p = ", signif(p_val_sui_co, 3))
)
# Plot
ggplot(pine_avg_subset, aes(x = Treatment, y = HeightChange)) +
geom_boxplot(aes(fill = Treatment), color = "black", outlier.shape = NA) +
geom_point(aes(color = Fertiliser), size = 3, position = position_dodge(width = 0.75)) +
geom_text(
data = p_labels_pine,
aes(x = Treatment, y = HeightChange, label = label),
inherit.aes = FALSE,
vjust = 0
) +
scale_fill_manual(values = treatment_cols) +
scale_color_brewer(palette = "Set1") +
theme_bw() +
labs(
x = "Treatment",
y = "Height Change",
color = "Fertiliser",
title = "Pine Height Change by Treatment (sui vs co)"
)
data <- changeinhts_df%>%
mutate(Fertiliser = factor(Fertiliser, levels = c("0", "25", "50", "75", "100")))
treatment_cols <- c(
"co" = "orange",
"cb" = "orange",
"heb" = "forestgreen",
"pax" = "forestgreen"
)
###birch########################################################################
# Filter birch and average per Fertiliser × Treatment
birch_avg <- data %>%
filter(Species == 'BP') %>%
group_by(Treatment, Fertiliser) %>%
summarise(HeightChange = mean(HeightChange, na.rm = TRUE), .groups = "drop")
###ttest
subset_heb <- subset(birch, Treatment %in% c("co", "heb"))
t_test_heb <- t.test(
HeightChange ~ Treatment,
data = subset_heb
)
p_val_heb = round(t_test_heb$p.value,2)
#do a t test for birch against co
subset_pax <- subset(birch, Treatment %in% c("co", "pax"))
t_test_pax <- t.test(
HeightChange ~ Treatment,
data = subset_pax
)
p_val_pax = round(t_test_pax$p.value,2)
#df to add to gg plot
p_labels <- data.frame(
Treatment = c("heb", "pax"),               # Treatments to annotate
HeightChange = c(max(birch_avg$HeightChange[birch_avg$Treatment == "heb"]) * 1.05,
max(birch_avg$HeightChange[birch_avg$Treatment == "pax"]) * 1.05),
label = c(paste0("p = ", signif(p_val_heb, 3)),
paste0("p = ", signif(p_val_pax, 3)))
)
##end t test#########
# Plot
ggplot(birch_avg, aes(x = Treatment, y = HeightChange)) +
geom_boxplot(aes(fill = Treatment), color = "black", outlier.shape = NA) +
geom_point(aes(color = Fertiliser), size = 3, position = position_dodge(width = 0.75)) +
geom_text(
data = p_labels,
aes(x = Treatment, y = HeightChange, label = label),
inherit.aes = FALSE,
vjust = 0  # position just above the boxplot
) +
scale_fill_manual(values = treatment_cols) +
scale_color_brewer(palette = "Set1") +
theme_bw() +
labs(
x = "Treatment",
y = "Height Change",
color = "Fertiliser",
title = "Birch Height Change by Treatment (Average per Fertiliser Level)"
)
###pine#########################################################################
treatment_cols <- c(
"co" = "orange",
"cb" = "orange",
"sui" = "forestgreen"
)
pine_avg <- data %>%
filter(Species == 'PS') %>%
group_by(Treatment, Fertiliser) %>%
summarise(HeightChange = mean(HeightChange, na.rm = TRUE), .groups = "drop")
###ttest
pine_avg_subset <- pine_avg %>%
filter(Treatment %in% c("sui", "co", "cb"))
# Compute t-test
t_test_sui_co <- t.test(
HeightChange ~ Treatment,
data = pine_avg_subset %>%filter(Treatment %in% c("co","sui"))
)
# Extract p-value
p_val_sui_co <- t_test_sui_co$p.value
# Create label data frame
p_labels_pine <- data.frame(
Treatment = "sui",  # put the label above 'sui'
HeightChange = max(pine_avg_subset$HeightChange) * 1.05,
label = paste0("p = ", signif(p_val_sui_co, 3))
)
# Plot
ggplot(pine_avg_subset, aes(x = Treatment, y = HeightChange)) +
geom_boxplot(aes(fill = Treatment), color = "black", outlier.shape = NA) +
geom_point(aes(color = Fertiliser), size = 3, position = position_dodge(width = 0.75)) +
geom_text(
data = p_labels_pine,
aes(x = Treatment, y = HeightChange, label = label),
inherit.aes = FALSE,
vjust = 0
) +
scale_fill_manual(values = treatment_cols) +
scale_color_brewer(palette = "Set1") +
theme_bw() +
labs(
x = "Treatment",
y = "Height Change",
color = "Fertiliser",
title = "Pine Height Change by Treatment (sui vs co)"
)
###sitka########################################################################
treatment_cols <- c(
"co" = "orange",
"cb" = "orange",
"heb" = "forestgreen",
"pax" = "forestgreen",
"sui" = "forestgreen"
)
# Filter Sitka data to relevant treatments
sitka_subset <- sitka_avg %>%
filter(Treatment %in% c("co", "heb", "pax", "sui"))
# Compute t-tests for each treatment vs 'co'
t_tests <- lapply(c("heb", "pax", "sui"), function(trt) {
tmp <- t.test(
HeightChange ~ Treatment,
data = sitka_subset %>% filter(Treatment %in% c("co", trt))
)
data.frame(
Treatment = trt,
HeightChange = max(sitka_subset$HeightChange) * 1.05,  # position above max
label = paste0("p = ", signif(tmp$p.value, 3))
)
})
p_labels_sitka <- do.call(rbind, t_tests)
# Plot
ggplot(sitka_subset, aes(x = Treatment, y = HeightChange)) +
geom_boxplot(aes(fill = Treatment), color = "black", outlier.shape = NA) +
geom_point(aes(color = Fertiliser), size = 3, position = position_dodge(width = 0.75)) +
geom_text(
data = p_labels_sitka,
aes(x = Treatment, y = HeightChange, label = label),
inherit.aes = FALSE,
vjust = 0
) +
scale_fill_manual(values = treatment_cols) +
scale_color_brewer(palette = "Set1") +
theme_bw() +
labs(
x = "Treatment",
y = "Height Change",
color = "Fertiliser",
title = "Sitka Height Change by Treatment (t-test vs co)"
)
data <- changeinhts_df%>%
mutate(Fertiliser = factor(Fertiliser, levels = c("0", "25", "50", "75", "100")))
treatment_cols <- c(
"co" = "orange",
"cb" = "orange",
"heb" = "forestgreen",
"pax" = "forestgreen"
)
###birch########################################################################
# Filter birch and average per Fertiliser × Treatment
birch_avg <- data %>%
filter(Species == 'BP') %>%
group_by(Treatment, Fertiliser) %>%
summarise(HeightChange = mean(HeightChange, na.rm = TRUE), .groups = "drop")
###ttest
subset_heb <- subset(birch, Treatment %in% c("co", "heb"))
t_test_heb <- t.test(
HeightChange ~ Treatment,
data = subset_heb
)
p_val_heb = round(t_test_heb$p.value,2)
#do a t test for birch against co
subset_pax <- subset(birch, Treatment %in% c("co", "pax"))
t_test_pax <- t.test(
HeightChange ~ Treatment,
data = subset_pax
)
p_val_pax = round(t_test_pax$p.value,2)
#df to add to gg plot
p_labels <- data.frame(
Treatment = c("heb", "pax"),               # Treatments to annotate
HeightChange = c(max(birch_avg$HeightChange[birch_avg$Treatment == "heb"]) * 1.05,
max(birch_avg$HeightChange[birch_avg$Treatment == "pax"]) * 1.05),
label = c(paste0("p = ", signif(p_val_heb, 3)),
paste0("p = ", signif(p_val_pax, 3)))
)
##end t test#########
# Plot
ggplot(birch_avg, aes(x = Treatment, y = HeightChange)) +
geom_boxplot(aes(fill = Treatment), color = "black", outlier.shape = NA) +
geom_point(aes(color = Fertiliser), size = 3, position = position_dodge(width = 0.75)) +
geom_text(
data = p_labels,
aes(x = Treatment, y = HeightChange, label = label),
inherit.aes = FALSE,
vjust = 0  # position just above the boxplot
) +
scale_fill_manual(values = treatment_cols) +
scale_color_brewer(palette = "Set1") +
theme_bw() +
labs(
x = "Treatment",
y = "Height Change",
color = "Fertiliser",
title = "Birch Height Change by Treatment (Average per Fertiliser Level)"
)
###pine#########################################################################
treatment_cols <- c(
"co" = "orange",
"cb" = "orange",
"sui" = "forestgreen"
)
pine_avg <- data %>%
filter(Species == 'PS') %>%
group_by(Treatment, Fertiliser) %>%
summarise(HeightChange = mean(HeightChange, na.rm = TRUE), .groups = "drop")
###ttest
pine_avg_subset <- pine_avg %>%
filter(Treatment %in% c("sui", "co", "cb"))
# Compute t-test
t_test_sui_co <- t.test(
HeightChange ~ Treatment,
data = pine_avg_subset %>%filter(Treatment %in% c("co","sui"))
)
# Extract p-value
p_val_sui_co <- t_test_sui_co$p.value
# Create label data frame
p_labels_pine <- data.frame(
Treatment = "sui",  # put the label above 'sui'
HeightChange = max(pine_avg_subset$HeightChange) * 1.05,
label = paste0("p = ", signif(p_val_sui_co, 3))
)
# Plot
ggplot(pine_avg_subset, aes(x = Treatment, y = HeightChange)) +
geom_boxplot(aes(fill = Treatment), color = "black", outlier.shape = NA) +
geom_point(aes(color = Fertiliser), size = 3, position = position_dodge(width = 0.75)) +
geom_text(
data = p_labels_pine,
aes(x = Treatment, y = HeightChange, label = label),
inherit.aes = FALSE,
vjust = 0
) +
scale_fill_manual(values = treatment_cols) +
scale_color_brewer(palette = "Set1") +
theme_bw() +
labs(
x = "Treatment",
y = "Height Change",
color = "Fertiliser",
title = "Pine Height Change by Treatment (sui vs co)"
)
###sitka########################################################################
treatment_cols <- c(
"co" = "orange",
"cb" = "orange",
"heb" = "forestgreen",
"pax" = "forestgreen",
"sui" = "forestgreen"
)
# Filter Sitka data to relevant treatments
sitka_subset <- sitka_avg %>%
filter(Treatment %in% c("co","cb" , "heb", "pax", "sui"))
# Compute t-tests for each treatment vs 'co'
t_tests <- lapply(c("heb", "pax", "sui"), function(trt) {
tmp <- t.test(
HeightChange ~ Treatment,
data = sitka_subset %>% filter(Treatment %in% c("co", trt))
)
data.frame(
Treatment = trt,
HeightChange = max(sitka_subset$HeightChange) * 1.05,  # position above max
label = paste0("p = ", signif(tmp$p.value, 3))
)
})
p_labels_sitka <- do.call(rbind, t_tests)
# Plot
ggplot(sitka_subset, aes(x = Treatment, y = HeightChange)) +
geom_boxplot(aes(fill = Treatment), color = "black", outlier.shape = NA) +
geom_point(aes(color = Fertiliser), size = 3, position = position_dodge(width = 0.75)) +
geom_text(
data = p_labels_sitka,
aes(x = Treatment, y = HeightChange, label = label),
inherit.aes = FALSE,
vjust = 0
) +
scale_fill_manual(values = treatment_cols) +
scale_color_brewer(palette = "Set1") +
theme_bw() +
labs(
x = "Treatment",
y = "Height Change",
color = "Fertiliser",
title = "Sitka Height Change by Treatment (t-test vs co)"
)
